#:import webbrowser webbrowser
#:import utils kivy.utils


# ------ custom widget classes ------ #
<WidgetImage>:
    image_work: image_work
    Image:
        pos: root.center_x-self.width/2, root.center_y-self.height/2
        id: image_work
        keep_ratio: False
        allow_stretch: True

<WidgetSpacing@Widget>
    size_hint: None, None
    size: dp(8), 0

<ButtonWithImageAtCenter>:
    image_source: self.image_source
    size_hint: None, None
    size: dp(30), dp(30)
    canvas:
        Rectangle:
            size: self.width-dp(8), self.height-dp(8)
            pos: self.center_x-(self.width-dp(8))/2, self.center_y-(self.height-dp(8))/2
            source: self.image_source

<LabelLayoutWidget@Label>:
    size_hint: None, None
    size: self.texture_size
    pos_hint: {"center_y": 0.5}

<NoMultilineTextInput@TextInput>:
    multiline: False
    cursor_color: 0, 0, 0, 1

<MultilineTextInput@TextInput>:
    cursor_color: 0, 0, 0, 1


<LayoutSelectImagePath>:
    size_hint: 1, None
    height: dp(30)
    WidgetSpacing:
    LabelLayoutWidget:
        text: root.parent.text_select_image + " : "

    NoMultilineTextInput:
        multiline: False
        text: root.path_to_image
    WidgetSpacing:
    ButtonWithImageAtCenter:
        on_press: root.select_image()
        image_source: "images/folder_icon.png"


<ControlLayout@BoxLayout>:
    size_hint: 1, None
    height: dp(30)

<AppCheckBox@CheckBox>:
    size_hint: None, None
    size: dp(20), dp(20)
    pos_hint: {"center_y": 0.5}
# ------------------------------- #


<LayoutControlWidget>:
    orientation: "vertical"
    spacing: dp(8)

    # --- select the image file --- #
    LayoutSelectImagePath:
    # ----------------------------- #

    # --- remove the background --- #
    # select if you want to remove the background
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: root.text_remove_bg + " : "
        AppCheckBox:
            id: bg_remove

    # enter/get your api key (this layout don't appear if you don't want to remove the background)
    ControlLayout:
        opacity: 1 if bg_remove.state == "down" else 0
        height: dp(30) if bg_remove.state == "down" else 0
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Api key : "
        NoMultilineTextInput:
        WidgetSpacing:
        ButtonWithImageAtCenter:
            image_source: "images/info_icon.png"
            on_press: webbrowser.open("https://www.remove.bg/api")
    # ---------------------------- #

    # --- resize the image --- #
    # select if you want to resize the image
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Resize : "
        AppCheckBox:
            id: resize

    # choose to keep the ratio of the image or not and give the new size (this layout don't appear if you don't
    # want to resize the image)
    ControlLayout:
        spacing: dp(10)
        opacity: 1 if resize.state == "down" else 0
        height: dp(97) if resize.state == "down" else 0
        orientation: "vertical"
        BoxLayout:
            WidgetSpacing:
            LabelLayoutWidget:
                text: "Keep ratio : "
            AppCheckBox:
                id: keep_ratio
                state: "down" if do_not_keep_ratio.state == "normal" else "normal"
        BoxLayout:
            WidgetSpacing:
            LabelLayoutWidget:
                text: "Don't keep ratio : "
            AppCheckBox:
                id: do_not_keep_ratio
                state: "down" if keep_ratio.state == "normal" else "normal"
        BoxLayout:
            WidgetSpacing:
            LabelLayoutWidget:
                text: "Width : "
            NoMultilineTextInput:
                size_hint: None, 1
                width: dp(75)
            WidgetSpacing:
            LabelLayoutWidget:
                text: "Height : "
            NoMultilineTextInput:
                size_hint: None, 1
                width: dp(75)
    # -------------------------- #

    # --- select if you want to crop the image --- #
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Crop : "
        AppCheckBox:
    # --------------------------------------------------- #

    # --- select if you want to add text to your image and enter text --- #
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Add a text zone : "
        AppCheckBox:
            id: add_text

    ControlLayout:
        opacity: 1 if add_text.state == "down" else 0
        height: dp(50) if add_text.state == "down" else 0
        WidgetSpacing:
        MultilineTextInput:
    # --------------------------------------------------- #

    # --- choose the output format --- #
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Modify output format (png by default) : "
        AppCheckBox:
            id: image_format

    ControlLayout:
        opacity: 1 if image_format.state == "down" else 0
        height: dp(30) if image_format.state == "down" else 0
        #:set spacing dp(12)
        WidgetSpacing:
            width: spacing
        LabelLayoutWidget:
            text: "jpg : "
        AppCheckBox:
        WidgetSpacing:
            width: spacing
        LabelLayoutWidget:
            text: "bmp : "
        AppCheckBox:
        WidgetSpacing:
            width: spacing
        LabelLayoutWidget:
            text: "gif : "
        AppCheckBox:
        WidgetSpacing:
            width: spacing
        LabelLayoutWidget:
            text: "ico : "
        AppCheckBox:
    # -------------------------------- #

    # --- select if you want apply a color overlay --- #
    ControlLayout:
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Add color overlay : "
        AppCheckBox:
            id: overlay

    ControlLayout:
        opacity: 1 if overlay.state == "down" else 0
        height: dp(30) if overlay.state == "down" else 0
        WidgetSpacing:
        LabelLayoutWidget:
            text: "Color : "
        NoMultilineTextInput:
            size_hint: None, 1
            width: dp(90)
            id: color_code
            text: "#00000000"
        WidgetSpacing:
        Widget:
            id: color_preview
            size_hint: None, 1
            width: self.height
            pos_hint: {"center_y": 0.5}
            canvas.after:
                Color:
                    rgba: utils.get_color_from_hex(color_code.text) if len(color_code.text) > 1 else (0, 0, 0, 1)
                Rectangle:
                    pos: self.pos
                    size: self.size
            Image:
                allow_stretch: True
                keep_ratio: False
                source: "images/image_without_background.jpg"
                size: color_preview.size
                pos: color_preview.pos
    # -------------------------------------------- #


# ------ Main view of the image editing part ------ #
<LayoutImageEditing>:
    ScrollView:
        do_scroll_y: True
        do_scroll_x: False
        LayoutControlWidget:
            size_hint: 1, None
            height: dp(540)
    WidgetSpacing:
        size: dp(18), 0
    WidgetImage:
# ------------------------------------------------- #
